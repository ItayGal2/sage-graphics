#!/bin/sh

for i in `ls *.log`
do
  fn=`basename $i .log`
  echo "Processing $fn"

  #echo "set terminal png color medium picsize 1024 768" > /tmp/gnu
  #echo "set output '$fn.png'" >> /tmp/gnu

  echo "set terminal postscript enhanced color" > /tmp/gnu
  echo "set output '$fn.ps'" >> /tmp/gnu

  echo "set grid" >> /tmp/gnu
  echo "set xrange [0:]" >> /tmp/gnu
  echo "set yrange [0:]" >> /tmp/gnu
  echo "set xlabel 'Time (sec)'" >> /tmp/gnu
  echo "set key right below Right" >> /tmp/gnu
  echo "set title 'Experiment $fn'" >> /tmp/gnu

  # for gnuplot 4.0
  echo "plot '$i' using 1:2 title \"Bandwidth (Mbps)\" with linesp linewidth 2 ps 1, '$i' using 1:3 title \"Frame Rate (fps)\" with boxes" >> /tmp/gnu
  # for gnuplot 4.0
  #echo "plot '$i' using 1:2 title \"Bandwidth (Mbps)\" with linesp linewidth 2 ps 1, '$i' using 1:3 title \"Frame Rate (fps)\" with boxes fs solid 0.25 " >> /tmp/gnu

  gnuplot /tmp/gnu
  #/bin/rm /tmp/gnu

  convert $fn.ps -rotate 90 -geometry 1024x768 $fn.png
  /bin/rm -f $fn.ps

done

